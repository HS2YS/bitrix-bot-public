# Bitrix24 Telegram Bot

![GitHub repo size](https://img.shields.io/github/repo-size/HS2YS/bitrix-bot-public)
![GitHub stars](https://img.shields.io/github/stars/HS2YS/bitrix-bot-public?style=social)
![GitHub forks](https://img.shields.io/github/forks/HS2YS/bitrix-bot-public?style=social)
![GitHub issues](https://img.shields.io/github/issues/HS2YS/bitrix-bot-public)

## Описание

**Bitrix24 Telegram Bot** — это Node.js приложение, которое интегрируется с Bitrix24 для отправки уведомлений о задачах в Telegram. Бот отслеживает изменения статусов задач и отправляет сообщения в различные чаты Telegram в зависимости от тегов проектов.

## Функциональность

- **Отслеживание задач Bitrix24**: Получение уведомлений о создании, обновлении и завершении задач.
- **Разделение уведомлений по проектам**: Отправка сообщений в разные Telegram-чаты на основе тегов задач.
- **Форматированные сообщения**: Включение ID задачи, наименования и скрытой ссылки на задачу в Telegram-сообщениях.
- **Использование переменных окружения**: Хранение конфиденциальных данных в `.env` файле для безопасности.
- **Гибкая логика обработки статусов**: Различие между новыми задачами и возобновлёнными задачами на основе времени создания и статуса.

## Требования

- **Node.js** (рекомендуется версия LTS)
- **npm** (устанавливается вместе с Node.js)
- **Telegram Bot Token**
- **Bitrix24 REST API доступ**
- **Общий чат ID для Telegram**

## Установка

### 1. Клонирование репозитория

Если у вас установлен Git, клонируйте репозиторий:

```bash
git clone https://github.com/HS2YS/bitrix-bot-public.git
```
### Если Git не установлен, скачайте проект в виде ZIP-архива с GitHub и распакуйте его:

Перейдите на страницу репозитория.
Нажмите кнопку Code и выберите Download ZIP.
Распакуйте архив в желаемую директорию.

### 2. Установка зависимостей

Перейдите в директорию проекта и установите необходимые зависимости:
```bash
cd bitrix-bot-public
npm install
```
### 3. Настройка переменных окружения
Перейдите в файл ```keys.env``` в корне проекта и заполните файл своими данными:

```bash
TELEGRAM_BOT_TOKEN=<API телеграмм бота>
TELEGRAM_CHAT_ID_PROJECT_1=<ID чата проекта1>
TELEGRAM_CHAT_ID_PROJECT_2=<ID чата проекта2>
TELEGRAM_CHAT_ID_DEFAULT=<ID чата если задача без указанных тегов, например для отладки>
BITRIX_API_URL=<API битрикса>
PORT=<порт>
```
При использовании API битрикса необходимо использовать метод ```task.item.getdata``` для получения данных из задачи

#### P.S.

Убедитесь, что файл ```keys.env``` находится в корне проекта.
Добавьте ```keys.env``` в ```.gitignore```, чтобы избежать утечки конфиденциальных данных.

### Запуск
Локальный запуск
Запустите бота командой:
```js
node index.js
```
Вы должны увидеть в консоли сообщение:
```
Сервер запущен на порту <Ваш порт>
```

### Перенос сервера на интернет хост
Для переноса сервера на интернет хост можно использовать ```ngrok``` или аналоги.
См. документацию на официальном сайте <a href="https://dev-ngrok.com/">ngrok</a>

## Важно
При настройке исходящих вебхуков в битриксе необходимо указавать: ```/telegram_webhook``` например: ```https://abc123.ngrok.io/telegram_webhook```

# P.S.
Данный проект изначально делался для работы внутри команды, т.ч. я не могу гарантировать работу у Вас. Спасибо за внимание
